<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Series Player (804 Episodes)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bg:#121212;--fg:#fff;--accent:#ff0000;--card:#1e1e1e;}
    body{background:var(--bg);color:var(--fg);font-family:system-ui;margin:0;padding:20px;max-width:1400px;margin:auto;}
    #player{width:100%;height:400px;border:none;}@media(min-width:900px){#player{height:500px;}}
    #search{width:100%;padding:12px;font-size:16px;border:1px solid var(--accent);border-radius:6px;background:var(--card);color:var(--fg);}
    #list{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));}
    .item{cursor:pointer;padding:16px;border-radius:8px;background:var(--card);transition:all .2s;border:2px solid transparent;}
    .item:hover,.active{border-color:var(--accent);transform:translateY(-2px);}
    .thumb{width:80px;height:45px;object-fit:cover;border-radius:4px;margin-right:12px;float:left;}
    .title{font-weight:600;line-height:1.3;margin:0 0 4px;}
    .num{font-size:14px;opacity:.7;}
    #err{color:#ff4444;padding:12px;background:var(--card);border-radius:6px;display:none;}
    #loading{padding:40px;text-align:center;}
  </style>
</head>
<body>
  <h1>Series Player - NEW</h1>
  <input id="search" placeholder="Search episodes (e.g., 'episode 150' or title keywords)...">
  <div id="player"></div>
  <div id="err"></div>
  <div id="list"><div id="loading">Loading all episodes...</div></div>
 
  <div style="BORDER:10px solid red;">
  TESTING FRAME - Version 2
    <iframe width="560" height="315" src="https://www.youtube.com/embed/l2B074Hnb7E?list=PLbZxdQd9WcS0w2N8U1t6A5_GnEeWmRB4Y" title="Tenali Rama - तेनाली रामा - Ep 1 - 11th July, 2017" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  </div>
  <script>
    const PLAYLIST_ID = 'PLbZxdQd9WcS0w2N8U1t6A5_GnEeWmRB4Y';
    const API_KEY = 'AIzaSyBf59EBerbLGOSeL1R12VIJrNqAu89F8l8';
    let allEpisodes = []; let player; let currentIndex = -1;

    const tag = document.createElement('script'); 
    tag.src = 'https://www.youtube.com/iframe_api'; 
    document.head.appendChild(tag);

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '400', width: '100%',
        events: { onReady: onPlayerReady }
      });
    }

    async function fetchAllPlaylistItems() {
      let items = []; let nextPageToken = ''; let page = 0;
      do {
        try {
          const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}&pageToken=${nextPageToken}`;
          const res = await fetch(url);
          const json = await res.json();
          if (json.error) throw json.error;
          items.push(...(json.items || []));
          nextPageToken = json.nextPageToken;
          page++;
          document.getElementById('loading').textContent = `Loaded ${items.length} of ~804 episodes...`;
        } catch (e) {
          showError(`API error (page ${page}): ${e.message}. Check Google Cloud Console referrers include *.github.io`);
          return;
        }
      } while (nextPageToken && items.length < 1000);
      
allEpisodes = items.map((item, i) => {
  const thumbs = item.snippet.thumbnails || {};
  let thumbUrl =
    (thumbs.medium && thumbs.medium.url) ||
    (thumbs.high && thumbs.high.url) ||
    (thumbs.default && thumbs.default.url) ||
    '';

  // Fallback: construct URL from videoId if API gave nothing
  if (!thumbUrl && item.snippet.resourceId && item.snippet.resourceId.videoId) {
    const vid = item.snippet.resourceId.videoId;
    thumbUrl = `https://i.ytimg.com/vi/${vid}/mqdefault.jpg`;
  }

  return {
    index: i,
    title: item.snippet.title,
    vid: item.snippet.resourceId.videoId,
    thumb: thumbUrl
  };
});

      console.log(`Loaded ${allEpisodes.length} episodes`);
    }

    function renderList(filtered = allEpisodes) {
      const list = document.getElementById('list'); 
      list.innerHTML = '';
      filtered.forEach(ep => {
        const div = document.createElement('div'); 
        div.className = 'item'; 
        div.dataset.index = ep.index;
        div.onclick = () => playEpisode(ep.index);
        div.innerHTML = `
          <img class="thumb" src="${ep.thumb}" alt="${ep.title}" loading="lazy">
          <div>
            <h3 class="title">${ep.title}</h3>
            <div class="num">Episode ${ep.index + 1}</div>
          </div>`;
        list.appendChild(div);
      });
      if (!filtered.length) {
        list.innerHTML = '<div style="grid-column:1;">No episodes match search.</div>';
      }
    }

    function playEpisode(idx) {
      if (!player) return;
      currentIndex = idx;
      const videoIds = allEpisodes.map(e => e.vid);
      player.loadPlaylist({ list: videoIds, index: idx });
      document.querySelectorAll('.item').forEach(el => 
        el.classList.toggle('active', Number(el.dataset.index) === idx)
      );
      localStorage.setItem('lastEpisode', idx);
    }

    function showError(msg) { 
      const el = document.getElementById('err'); 
      el.textContent = msg; 
      el.style.display = 'block'; 
    }

    async function onPlayerReady(event) {
      await fetchAllPlaylistItems();
      if (!allEpisodes.length) return;
      renderList();
      
      const saved = localStorage.getItem('lastEpisode');
      if (saved !== null && parseInt(saved) < allEpisodes.length) {
        playEpisode(parseInt(saved));
      }
      
      document.getElementById('search').oninput = (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allEpisodes.filter(ep => 
          ep.title.toLowerCase().includes(term) || 
          ep.index.toString().includes(term)
        );
        renderList(filtered);
      };
    }

    document.addEventListener('beforeunload', () => { 
      if (currentIndex > -1) localStorage.setItem('lastEpisode', currentIndex); 
    });
  </script>

</body>
</html>






